From d5e907879a5e6c96b5e2aeffe10f7f005a2ad9ec Mon Sep 17 00:00:00 2001
From: Your Name <you@example.com>
Date: Sun, 30 Jul 2023 10:22:04 +0100
Subject: [PATCH] patch

---
 src/nvc_info.c | 20 ++++++++++++++------
 1 file changed, 14 insertions(+), 6 deletions(-)

diff --git a/src/nvc_info.c b/src/nvc_info.c
index 7ffbb4c..d4c8a8a 100644
--- a/src/nvc_info.c
+++ b/src/nvc_info.c
@@ -515,7 +515,7 @@ lookup_jetson_devices(struct error *err, struct nvc_jetson_info *info, const cha
 }
 
 static int
-parse_file(struct error *err, const char *path, const char *root, struct nvc_jetson_info *jetson)
+parse_file(struct error *err, const char *path, const char *root, const char *nixos_root, struct nvc_jetson_info *jetson)
 {
         struct csv ctx;
         int rv = -1;
@@ -530,17 +530,25 @@ parse_file(struct error *err, const char *path, const char *root, struct nvc_jet
         if (csv_parse(&ctx, jetson) < 0)
                 goto fail;
 
-        if (lookup_jetson_libs(err, jetson, root) < 0)
+        if (lookup_jetson_libs(err, jetson, nixos_root) < 0) {
+                log_info("fail libs");
                 goto fail;
+        }
 
-        if (lookup_jetson_dirs(err, jetson, root) < 0)
+        if (lookup_jetson_dirs(err, jetson, nixos_root) < 0) {
+                log_info("fail dirs");
                 goto fail;
+        }
 
-        if (lookup_jetson_devices(err, jetson, root) < 0)
+        if (lookup_jetson_devices(err, jetson, root) < 0) {
+                log_info("fail devices");
                 goto fail;
+        }
 
-        if (lookup_jetson_symlinks(err, jetson, root) < 0)
+        if (lookup_jetson_symlinks(err, jetson, nixos_root) < 0) {
+                log_info("fail symlinks");
                 goto fail;
+        }
 
         rv = 0;
 
@@ -581,7 +589,7 @@ lookup_jetson(struct error *err, struct nvc_driver_info *info, const char *root)
                 if ((file_info->path = xstrdup(err, files[i])) == NULL)
                         goto fail;
 
-                if (parse_file(err, files[i], nixos_base, &file_info->info) < 0)
+                if (parse_file(err, files[i], root, nixos_base, &file_info->info) < 0)
                         goto fail;
 
                 if ((tmp = jetson_info_append(err, &file_info->info, dst)) == NULL)
-- 
2.38.5

